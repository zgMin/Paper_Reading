# SpecTr: Fast Speculative Decoding via Optimal Transport
- **作者**: Ziteng Sun, Ziteng_Sun, Ananda Theertha Suresh, Jae Hun Ro, Ahmad Beirami, Himanshu Jain, Felix Yu, Michael Riley, Sanjiv Kumar
- **出版年份**: 2023
- **期刊/会议**: Workshop on Efficient Systems for Foundation Models @ ICML2023

## 摘要
本文介绍了SpecTr，一种用于自回归模型的快速投机解码算法。投机解码旨在通过并行生成多个标记并基于大型模型的条件概率验证其接受性来提高解码速度。作者提出了一种基于最优传输理论的标记级最大耦合算法，用于从初步模型中选择有效标记。他们还探讨了沿批次轴的并行化可能性，以进一步提高解码速度。本文提供了理论见解、算法改进以及在标准数据集上展示SpecTr有效性的实验结果。

## 介绍
- 背景和动机：本文解决了自回归模型中提高解码速度的问题。它介绍了一种名为投机解码的技术，该技术通过并行生成多个标记并基于大模型的条件概率选择有效标记。
- 方法：作者提出了SpecTr，一种新算法，利用最优传输理论和批次轴的并行化来实现更快的解码。
- 本文旨在提供对投机解码的理论理解，讨论最优条件，并探讨算法改进。


## 方法
该算法包括三个主要步骤：初步构建、条件概率计算和初步选择。
1. 初步构建步骤通过从计算成本较低的初步模型中采样标记来生成初步序列。
2. 条件概率计算步骤并行计算大模型对每个标记的条件分布。
3. 初步选择步骤基于初步序列和两个模型的条件概率选择有效标记。
4. 该算法递归应用以生成最终的解码序列。

<img width="420" alt="image" src="https://github.com/zgMin/Paper_Reading/assets/52092775/009695f0-9eb2-4645-b99f-575a8fff5b86">

大致方法：将SpS转换为最优化运输问题，将draft运输到target，并将问题扩展到多个draft的情况下，每个draft都通过MOT-k采样（实际上是多个draft情况下的SpD， 越到后边的draft条件约严格），然后根据本文唯一一个图的解释从这多个采样后的draft推理出目标文本

## 实验结果
本文提供了标准数据集上的实验结果，展示了SpecTr在提高解码速度方面的有效性。结果显示，与基线方法相比，SpecTr在大模型的串行调用中实现了更多的解码标记。作者还将SpecTr与其他投机解码算法进行了比较，并展示了其卓越的性能。实验证实了本文提出的理论见解和算法改进。

<img width="395" alt="image" src="https://github.com/zgMin/Paper_Reading/assets/52092775/54ff0db8-30f6-447d-a0c9-c60424098bea">


## 结论
本文介绍了SpecTr，一种用于自回归模型的快速投机解码算法。SpecTr利用最优传输理论和沿批次轴的并行化来提高解码速度。本文提供了理论见解、算法改进以及在标准数据集上展示SpecTr有效性的实验结果。SpecTr提供了一种有原则的投机解码方法，并为这一领域的进一步研究开辟了可能性。


## 个人观点
- 将SpS与最优化运输理论结合，提供了一种新的视角看待投机解码，提供了大量的数学分析与证明
- 写作感觉不是很好，关键算法都扔附录里了，不看附录很难理解正文的做法
- 多个draft情况下，越到后边的draft条件约严格，这个我不明白是为了做什么

